name: Build

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    name: Build on ${{ matrix.arch }}
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        include:
          - arch: x64
            variant: x64-linux-15v3
          - arch: arm64
            variant: aarch64-linux-15
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y build-essential libavformat-dev libavcodec-dev \
          libavutil-dev libswresample-dev libupnp-dev
    
    - name: Download Diretta SDK (mock)
      run: |
        # In real workflow, you'd need to provide SDK access
        # For now, this is a placeholder
        echo "Note: Diretta SDK must be provided separately"
        echo "This CI is configured but requires SDK setup"
    
    - name: Build
      run: |
        # Would build with: make ARCH_NAME=${{ matrix.variant }}
        echo "Build step would run here with SDK"
    
    - name: Upload artifact
      if: success()
      uses: actions/upload-artifact@v3
      with:
        name: DirettaRendererUPnP-${{ matrix.arch }}
        path: bin/DirettaRendererUPnP
        retention-days: 7

  lint:
    name: Code Quality Check
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Check file formatting
      run: |
        # Check for trailing whitespace
        if git grep -I --line-number '[[:blank:]]$' -- '*.cpp' '*.hpp'; then
          echo "Found trailing whitespace"
          exit 1
        fi
        echo "No trailing whitespace found"
